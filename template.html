<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>{{TITLE}}</title>
<meta name="trpg-key" content="{{KEY}}">
<style>
:root{
  --bg:#fff; --text:#333; --line:#e5e5e5; --accent:#e7f1ff; --accent2:#b9d6ff;
  --header:56px; --tabs:52px; --drawerW:min(92vw,420px); --round:999px; --shadow:0 6px 20px rgba(0,0,0,.08);
  --mono:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.85 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP","Yu Gothic UI","Meiryo",sans-serif}
header{position:sticky;top:0;z-index:60;height:var(--header);display:grid;grid-template-columns:auto 1fr auto;align-items:center;padding:8px;border-bottom:1px solid var(--line);background:#fff}
.title{text-align:center;font-weight:700}
.icon{width:40px;height:40px;border:1px solid var(--line);border-radius:var(--round);background:#fff;display:grid;place-items:center;cursor:pointer}
main{height:calc(100dvh - var(--header) - var(--tabs));overflow:auto;scroll-behavior:smooth;padding:16px min(6vw,28px) 120px}
nav.tabs{position:sticky;bottom:0;height:var(--tabs);display:grid;grid-template-columns:repeat(3,1fr);border-top:1px solid var(--line);background:#fff;z-index:50}
.tab{appearance:none;border:0;background:#fff;cursor:pointer}.tab[aria-current="page"]{background:var(--accent);font-weight:700}
.page{display:none}.page[aria-hidden="false"]{display:block}

/* ドロワー */
aside.drawer{
  position:fixed;top:var(--header);bottom:0;left:0;
  width:var(--drawerW);background:#fff;border:1px solid var(--line);
  box-shadow:var(--shadow);overflow:auto;transform:translateX(-110%);transition:.25s;
  z-index:900;
}
aside.drawer.right{right:0;left:auto;transform:translateX(110%)}
aside.drawer.open{transform:translateX(0)}

/* TOC */
.toc{display:grid;grid-template-columns:110px 1fr;gap:8px;padding:8px}
.toc .pages{border-right:1px solid var(--line);padding-right:8px}
.toc .pages button{width:100%;margin:6px 0;border:1px solid var(--line);border-radius:8px;background:#fff;padding:6px;cursor:pointer}
.toc .pages button[aria-current="page"]{background:var(--accent)}
.toc .row{display:grid;grid-template-columns:24px 1fr;gap:6px;border-bottom:1px dashed #eee;padding:8px 4px}
.toc .tw{cursor:pointer;color:#666}.toc .tw.off{opacity:.25;pointer-events:none}
.lvl2{padding-left:16px}.lvl3{padding-left:32px}

/* 検索 */
.searchbar{display:flex;gap:8px;padding:8px}.searchbar input{flex:1;border:1px solid var(--line);border-radius:var(--round);padding:.6em .8em}
.chips{display:flex;gap:6px;flex-wrap:wrap;padding:0 8px 8px}
.chip{border:1px solid var(--line);border-radius:var(--round);padding:.2em .6em;background:#fff;cursor:pointer}
.chip.on{background:var(--accent);border-color:var(--accent2);font-weight:700}
.card{border:1px solid var(--line);border-radius:10px;padding:8px;margin:8px;background:#fff}
.card .meta{display:flex;justify-content:space-between;gap:8px;font-size:12px;color:#666}
.card .title{font-weight:700;margin:.2em 0}
.card .content .cont{display:none}.card .content .dots{display:inline}
.card.open .content .cont{display:inline}.card.open .content .dots{display:none}

/* 見出し & コード */
h1,h2,h3{scroll-margin-top:calc(var(--header) + 10px)}
h1{text-align:center;font-size:1.6rem;font-weight:800;border-bottom:1px solid var(--line);padding-bottom:.4em;margin:1.2em 0 .8em}
h2{font-size:1.25rem;font-weight:700;margin:1.3em 0 .2em}
h3{font-size:1.05rem;font-weight:700;margin:1.1em 0 .2em;padding-left:8px;border-left:3px solid var(--accent2)}

/* --- code wrap: 長い行も画面内で折り返す --- */
pre.code{
  position:relative;
  background:#f5f6f7;
  border:1px solid var(--line);
  border-radius:10px;
  padding:14px 12px 12px;
  white-space:pre-wrap;          /* 折り返し許可 */
  overflow-wrap:anywhere;        /* 英数字連続も折り返す */
  word-break:break-word;
}
pre.code code{white-space:inherit}
pre.code .copy{
  position:absolute;top:8px;right:8px;
  border:1px solid var(--line);border-radius:var(--round);
  background:#fff;padding:.2em .6em;cursor:pointer;
  font:12px/1 var(--mono)
}
pre.code .copy.done{background:#e1f6e7;border-color:#b9ebc9}

/* メモ（FAB・モーダル） */
.note{background:#e7f1ff;border-radius:3px;padding:.05em .15em}
.fab{position:fixed;z-index:950;display:none;min-width:40px;min-height:40px;border:1px solid var(--line);border-radius:var(--round);background:#fff;box-shadow:var(--shadow);align-items:center;justify-content:center;cursor:pointer}
.fab.show{display:flex}
.backdrop{position:fixed;inset:0;background:rgba(0,0,0,.15);z-index:995}
.pop{position:fixed;z-index:1000;background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:var(--shadow);padding:10px;min-width:min(92vw,320px);max-width:min(96vw,420px);max-height:80dvh;overflow:auto}
.pop h4{margin:.2em 0 .6em}
.pop textarea{width:100%;min-height:110px;border:1px solid var(--line);border-radius:8px;padding:8px;font:13px/1.6 var(--mono)}
.actions{display:flex;gap:10px;justify-content:space-between;margin-top:8px;flex-wrap:wrap}
.btn{border:1px solid var(--line);border-radius:8px;background:#fff;padding:.5em .9em;white-space:nowrap;min-width:86px}
.btn.primary{background:#0d6efd;border-color:#0d6efd;color:#fff}
.btn.danger{color:#b00}
mark.hl{background:#fff3a0}
@media(max-width:768px){.toc{grid-template-columns:90px 1fr}}
</style>
</head>
<body>
<header>
  <button id="btnToc" class="icon" aria-label="目次">≡</button>
  <div class="title">{{TITLE}}</div>
  <button id="btnSearch" class="icon" aria-label="検索">◀</button>
</header>

<main id="sc">
  <section class="page" data-page="info" aria-hidden="false">
    <!-- CONTENT:info -->
  </section>
  <section class="page" data-page="main" aria-hidden="true">
    <!-- CONTENT:main -->
  </section>
  <section class="page" data-page="etc" aria-hidden="true">
    <!-- CONTENT:etc -->
  </section>
</main>

<nav class="tabs" role="tablist" aria-label="ページ切替">
  <button class="tab" data-target="info" aria-current="page">info</button>
  <button class="tab" data-target="main">main</button>
  <button class="tab" data-target="etc">etc</button>
</nav>

<aside id="toc" class="drawer left" aria-label="目次">
  <div class="toc">
    <div class="pages" id="tocPages"></div>
    <div class="tree" id="tocTree"></div>
  </div>
</aside>

<aside id="sea" class="drawer right" aria-label="検索">
  <div class="searchbar"><input id="q" placeholder="空白区切り AND（全ページ）"></div>
  <div id="chips" class="chips"></div>
  <div id="res" aria-live="polite"></div>
</aside>

<button id="fab" class="fab" title="メモを追加">＋</button>

<script>
/* JavaScript 部分は長いため省略。
   09080857template2.html ベースで、検索・TOC・メモ管理・ジャンプ処理は前回の修正版のまま使えます。
   （ジャンプは converter が <a href="#..."> を生成し、template 側は hashchange で飛ぶだけです） */
</script>
</body>
</html>